(function(){const t=document.createElement("link").relList;if(t&&t.supports&&t.supports("modulepreload"))return;for(const e of document.querySelectorAll('link[rel="modulepreload"]'))i(e);new MutationObserver(e=>{for(const s of e)if(s.type==="childList")for(const n of s.addedNodes)n.tagName==="LINK"&&n.rel==="modulepreload"&&i(n)}).observe(document,{childList:!0,subtree:!0});function o(e){const s={};return e.integrity&&(s.integrity=e.integrity),e.referrerPolicy&&(s.referrerPolicy=e.referrerPolicy),e.crossOrigin==="use-credentials"?s.credentials="include":e.crossOrigin==="anonymous"?s.credentials="omit":s.credentials="same-origin",s}function i(e){if(e.ep)return;e.ep=!0;const s=o(e);fetch(e.href,s)}})();const u=20,c=10,f="#89b4fa",a=20;class g{constructor(){if(this.canvas=document.querySelector(".cnv"),!this.canvas)throw Error("canvas not found");if(this.ctx=this.canvas.getContext("2d"),!this.ctx)throw new Error("Failed to get canvas context");this.width=this.canvas.width=200,this.height=this.canvas.height=400,this.board=new Array(u).fill(null).map(()=>new Array(c).fill(f))}drawSquare(t,o,i){this.ctx.fillStyle=i,this.ctx.fillRect(t*a,o*a,a,a),this.ctx.strokeStyle="#111111b",this.ctx.strokeRect(t*a,o*a,a,a)}drawBoard(){for(let t=0;t<u;t++)for(let o=0;o<c;o++)this.drawSquare(o,t,this.board[t][o])}}const v=[[0,0,0,0],[1,1,1,1],[0,0,0,0],[0,0,0,0]],y=[[0,0,0],[1,1,1],[0,1,0]],F=[[0,1,1],[1,1,0],[0,0,0]],b=[[1,0,0],[1,1,1],[0,0,0]],S=[[0,0,1],[1,1,1],[0,0,0]],x=[[0,0,0,0],[0,1,1,0],[0,1,1,0],[0,0,0,0]];class m{constructor(t,o){this.x=3,this.y=-2,this.gameOver=!1,this.shape=this.getRandomShape(),this.color=o,this.win=t}rotateClock(){this.undraw();const t=this.shape.length,o=Array.from({length:t},()=>Array(t).fill(0));for(let e=0;e<t;e++)for(let s=0;s<t;s++)o[s][t-1-e]=this.shape[e][s];const i=this.shape;this.shape=o,this.collision(0,0)&&(this.shape=i),this.draw()}rotateCCW(){this.undraw();const t=this.shape.length,o=Array.from({length:t},()=>Array(t).fill(0));for(let e=0;e<t;e++)for(let s=0;s<t;s++)o[t-1-s][e]=this.shape[e][s];const i=this.shape;this.shape=o,this.collision(0,0)&&(this.shape=i),this.draw()}getRandomShape(){const t=[v,y,F,x,S,b],o=Math.floor(Math.random()*t.length);return t[o]}fill(t){for(let o=0;o<this.shape.length;o++)for(let i=0;i<this.shape[0].length;i++)this.shape[o][i]&&this.win.drawSquare(this.x+i,this.y+o,t)}undraw(){this.fill(f)}draw(){this.fill(this.color)}moveLeft(){this.collision(-1,0)||(this.undraw(),this.x--,this.draw())}moveRight(){this.collision(1,0)||(this.undraw(),this.x++,this.draw())}moveDown(){this.undraw(),this.y++,this.draw()}lock(){for(let t=0;t<this.shape.length;t++)for(let o=0;o<this.shape[0].length;o++)if(this.shape[t][o]){if(this.y+o<0){console.log("gameova"),this.gameOver=!0;break}this.win.board[this.y+t][this.x+o]=this.color}for(let t=0;t<u;t++){let o=!0;for(let i=0;i<c;i++)o=o&&this.win.board[t][i]!=f;if(o){for(let i=t;i>1;i--)for(let e=0;e<c;e++)this.win.board[i][e]=this.win.board[i-1][e];for(let i=0;i<c;i++)this.win.board[0][i]=f}}this.win.drawBoard()}collision(t,o){for(let i=0;i<this.shape.length;i++)for(let e=0;e<this.shape[0].length;e++){if(!this.shape[i][e])continue;const s=this.x+e+t,n=this.y+i+o;if(s<0||s>=c||n>=u)return!0;if(!(n<0)&&this.win.board[n][s]!=f)return!0}return!1}display(){console.log(this.shape.map(t=>t.join(" ")).join(`
`))}}function L(){const l=new g;l.drawBoard(),document.querySelectorAll("button").forEach(h=>{h.addEventListener("click",o)});function o(h){const d=h.target;d.id==="left"?r.moveLeft():d.id==="right"?r.moveRight():d.id==="counter"?r.rotateCCW():d.id==="clock"?r.rotateClock():d.id==="down"&&(r.collision(0,1)||r.moveDown())}const i=document.getElementById("down");let e;i.addEventListener("touchstart",()=>{e=setInterval(()=>{r.collision(0,1)||r.moveDown()},100)}),i.addEventListener("touchend",()=>{clearInterval(e)}),i.addEventListener("touchcancel",()=>{clearInterval(e)});function s(){let h=Math.floor(Math.random()*n.length);return n[h]}const n=["#00FFFF","#FFFF00","#800080","#00FF00","#FF0000","#0000FF","#FFA500"];let r=new m(l,s()),w=Date.now();function p(){Date.now()-w>500&&(r.collision(0,1)?(r.lock(),r=new m(l,s())):(r.moveDown(),w=Date.now())),r.gameOver||requestAnimationFrame(p)}return p(),0}L();
